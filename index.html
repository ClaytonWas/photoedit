<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3b82f6">
    <meta name="description" content="Professional photo editing webapp with advanced filters and layer support">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/styles.css">
    <script type="module" src="/scripts/ui.js"></script>
    <script type="module" src="/scripts/taskbarHandler.js"></script>
    <script type="module" src="/scripts/canvasHandler.js"></script>
    <script type="module" src="/scripts/layersHandler.js"></script>

    <title>PhotoEdits - Professional Photo Editor</title>
</head>
<body>
    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar">
        <div class="progress-bar-fill" id="progressBarFill"></div>
    </div>

    <!-- Mobile Header -->
    <header class="mobile-header">
        <h1 class="mobile-title">PhotoEdits</h1>
        <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle menu" aria-expanded="false">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
    </header>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

    <!-- Mobile Menu -->
    <nav class="mobile-menu" id="mobileMenu" role="navigation" aria-label="Main menu">
        <div class="mobile-menu-header">
            <h2>Menu</h2>
        </div>
        
        <div class="mobile-menu-section">
            <h3>File</h3>
            <div class="mobile-menu-item" id="mobileOpenFile" role="button" tabindex="0">
                <span class="icon">📁</span>
                <span>Open Image</span>
            </div>
            <div class="mobile-menu-item" id="mobileQuickExport" role="button" tabindex="0">
                <span class="icon">💾</span>
                <span>Quick Export</span>
            </div>
            <div class="mobile-menu-item" id="mobileResize" role="button" tabindex="0">
                <span class="icon">📏</span>
                <span>Resize</span>
            </div>
            <div class="mobile-menu-item" id="mobileCursorCrop" role="button" tabindex="0">
                <span class="icon">✂️</span>
                <span>Cursor Crop</span>
            </div>
            <div class="mobile-menu-item" id="mobileCrop" role="button" tabindex="0">
                <span class="icon">🔲</span>
                <span>Crop</span>
            </div>
        </div>
        
        <div class="mobile-menu-section">
            <h3>Image</h3>
            <div class="mobile-menu-item" id="mobileRotateCW90" role="button" tabindex="0">
                <span class="icon">↻</span>
                <span>Rotate 90°</span>
            </div>
            <div class="mobile-menu-item" id="mobileRotateCCW90" role="button" tabindex="0">
                <span class="icon">↺</span>
                <span>Rotate -90°</span>
            </div>
            <div class="mobile-menu-item" id="mobileHsv" role="button" tabindex="0">
                <span class="icon">🎨</span>
                <span>HSV Adjustment</span>
            </div>
        </div>
        
        <div class="mobile-menu-section">
            <h3>Filters</h3>
            <div class="mobile-menu-item" id="mobileGreyscale" role="button" tabindex="0">
                <span class="icon">⚫</span>
                <span>Greyscale</span>
            </div>
            <div class="mobile-menu-item" id="mobileSepia" role="button" tabindex="0">
                <span class="icon">🟤</span>
                <span>Sepia</span>
            </div>
            <div class="mobile-menu-item" id="mobileFilmEffects" role="button" tabindex="0">
                <span class="icon">🎞️</span>
                <span>Film Effects</span>
            </div>
            <div class="mobile-menu-item" id="mobilePaintedStylization" role="button" tabindex="0">
                <span class="icon">🖌️</span>
                <span>Painted</span>
            </div>
        </div>
        
        <div class="mobile-menu-section">
            <h3>Tools</h3>
            <div class="mobile-menu-item" id="mobileResetImage" role="button" tabindex="0">
                <span class="icon">🔄</span>
                <span>Reset Image</span>
            </div>
            <div class="mobile-menu-item" id="mobileToggleLayers" role="button" tabindex="0">
                <span class="icon">📋</span>
                <span>Layers</span>
            </div>
            <div class="mobile-menu-item" id="mobileToggleInfo" role="button" tabindex="0">
                <span class="icon">ℹ️</span>
                <span>Image Info</span>
            </div>
        </div>
    </nav>

    <!-- Desktop Taskbar -->
    <nav class="taskbar" role="menubar" aria-label="Main navigation">
        <div class="taskbarItem" role="menuitem" tabindex="0">
            <span>File</span>
            <ul class="taskbarItemDropdown" role="menu">
                <li id="openFile" role="menuitem" tabindex="0">📁 Open</li>
                <input id="uploadFile" type="file" accept="image/*" style="display: none;" aria-label="Upload image file">
                <li id="quickExport" role="menuitem" tabindex="0">💾 Quick Export</li>
                <li id="resize" role="menuitem" tabindex="0">📏 Resize</li>
                <li id="cursorCrop" role="menuitem" tabindex="0">✂️ Cursor Crop</li>
                <li id="crop" role="menuitem" tabindex="0">🔲 Crop</li>
            </ul>
        </div>

        <div class="taskbarItem" role="menuitem" tabindex="0">
            <span>Image</span>
            <ul class="taskbarItemDropdown" role="menu">
                <li class="taskbarItemDropdownContainsSubmenu" id="rotateImage" role="menuitem" tabindex="0">🔄 Rotate ▶
                    <ul class="taskbarItemDropdownIsSubmenu" role="menu">
                        <li id="rotateCW90" role="menuitem" tabindex="0">↻ Rotate 90°</li>
                        <li id="rotateCCW90" role="menuitem" tabindex="0">↺ Rotate -90°</li>
                    </ul>
                </li>
                <li id="hsv" role="menuitem" tabindex="0">🎨 HSV Adjustment</li>
            </ul>
        </div>

        <div class="taskbarItem" role="menuitem" tabindex="0">
            <span>Filter</span>
            <ul class="taskbarItemDropdown" role="menu">
                <li id="greyscale" role="menuitem" tabindex="0">⚫ Greyscale</li>
                <li id="sepia" role="menuitem" tabindex="0">🟤 Sepia</li>
                <li id="filmEffects" role="menuitem" tabindex="0">🎞️ Film Effects</li>
                <li id="paintedStylization" role="menuitem" tabindex="0">🖌️ Painted</li>
            </ul>
        </div>

        <div class="taskbarItem" role="menuitem" tabindex="0">
            <span>Visualizations</span>
            <ul class="taskbarItemDropdown" role="menu">
                <li class="taskbarItemDropdownContainsSubmenu" role="menuitem" tabindex="0">📐 Spatial Geometry ▶
                    <ul class="taskbarItemDropdownIsSubmenu" role="menu">
                        <li id="pointsInSpace" role="menuitem" tabindex="0">• Points In Space</li>
                        <li id="vectorsInSpace" role="menuitem" tabindex="0">→ Vectors In Space</li>
                    </ul>
                </li>
                <li class="taskbarItemDropdownContainsSubmenu" role="menuitem" tabindex="0">🔍 Edge Detection ▶
                    <ul class="taskbarItemDropdownIsSubmenu" role="menu">
                        <li class="taskbarItemDropdownContainsSubmenu" role="menuitem" tabindex="0">Sobel ▶
                            <ul class="taskbarItemDropdownIsSubmenu" role="menu">
                                <li id="sobelEdges" role="menuitem" tabindex="0">Regular</li>
                                <li id="sobelEdgesColouredDirections" role="menuitem" tabindex="0">Coloured Directions</li>
                            </ul>
                        </li>
                        <li class="taskbarItemDropdownContainsSubmenu" role="menuitem" tabindex="0">Prewitt ▶
                            <ul class="taskbarItemDropdownIsSubmenu" role="menu">
                                <li id="prewireEdges" role="menuitem" tabindex="0">Regular</li>
                                <li id="prewireEdgesColouredDirections" role="menuitem" tabindex="0">Coloured Directions</li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="taskbarItem" id="resetImage" role="menuitem" tabindex="0">
            <span>🔄 Reset Image</span>
        </div>
    </nav>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer" aria-live="polite"></div>

    <!-- Keyboard Shortcuts Hint -->
    <div class="keyboard-hint" id="keyboardHint">
        Press <kbd>Ctrl+O</kbd> to open, <kbd>Ctrl+S</kbd> to export
    </div>

    <!-- Modal Overlays -->
    <div class="modal-overlay" id="resizeModal" role="dialog" aria-labelledby="resizeModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="taskbarModuleTitle">
                <p id="resizeModalTitle">Resize Image</p>
                <button class="taskbarModuleClose" id="cancelResize" aria-label="Close resize dialog">×</button>
            </div>
            <div class="taskbarModuleContent">
                <div class="taskbarModuleOneLine">
                    <p>Width</p>
                    <input type="number" placeholder="pixels" id="resizeWidth" aria-label="Width in pixels">
                </div>
                <div class="taskbarModuleOneLine">
                    <p>Height</p>
                    <input type="number" placeholder="pixels" id="resizeHeight" aria-label="Height in pixels">
                </div>
                <div class="taskbarModuleOneLine">
                    <p>Constrained</p>
                    <input type="checkbox" id="constrainedCheckbox" aria-label="Maintain aspect ratio">
                </div>
                <div class="taskbarModuleOneLine" id="resizeScaleDIV" style="display: none;">
                    <p>Scale</p>
                    <input type="number" min="0.1" max="5" value="1" step="0.1" id="resizeScale" aria-label="Scale factor">
                </div>
                <div class="taskbarModuleOneLine">
                    <p>Interpolation</p>
                    <select id="interpolationType" aria-label="Interpolation method">
                        <option value="Default">Default</option>
                        <option value="Nearest Neighbour">Nearest Neighbour</option>
                        <option value="Bilinear">Bilinear</option>
                    </select>
                </div>
            </div>
            <button class="taskbarModuleSubmit" id="resizeSubmit">Resize</button>
        </div>
    </div>

    <div class="modal-overlay" id="cropModal" role="dialog" aria-labelledby="cropModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="taskbarModuleTitle">
                <p id="cropModalTitle">Crop Image</p>
                <button class="taskbarModuleClose" id="cancelCrop" aria-label="Close crop dialog">×</button>
            </div>
            <div class="taskbarModuleContent">
                <div class="taskbarModuleOneLine">
                    <p>Start Width</p>
                    <input type="number" placeholder="pixels" id="cropStartWidth" aria-label="Start width in pixels">
                </div>
                <div class="taskbarModuleOneLine">
                    <p>Start Height</p>
                    <input type="number" placeholder="pixels" id="cropStartHeight" aria-label="Start height in pixels">
                </div>
                <div class="taskbarModuleOneLine">
                    <p>End Width</p>
                    <input type="number" placeholder="pixels" id="cropEndWidth" aria-label="End width in pixels">
                </div>
                <div class="taskbarModuleOneLine">
                    <p>End Height</p>
                    <input type="number" placeholder="pixels" id="cropEndHeight" aria-label="End height in pixels">
                </div>
            </div>
            <button class="taskbarModuleSubmit" id="cropSubmit">Crop</button>
        </div>
    </div>

    <div class="modal-overlay" id="hsvModal" role="dialog" aria-labelledby="hsvModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="taskbarModuleTitle">
                <p id="hsvModalTitle">HSV Adjustment</p>
                <button class="taskbarModuleClose" id="hsvCancel" aria-label="Close HSV dialog">×</button>
            </div>
            <div class="taskbarModuleContent">
                <div class="taskbarModuleOneLine">
                    <p>Hue</p>
                    <input type="range" min="-180" max="180" step="1" value="0" id="hueSlider" aria-label="Hue adjustment">
                </div>
                <div class="taskbarModuleOneLine">
                    <p>Saturation</p>
                    <input type="range" min="0" max="200" step="1" value="100" id="saturationSlider" aria-label="Saturation adjustment">
                </div>
                <div class="taskbarModuleOneLine">
                    <p>Brightness</p>
                    <input type="range" min="0" max="200" step="1" value="100" id="brightnessSlider" aria-label="Brightness adjustment">
                </div>
            </div>
            <button class="taskbarModuleSubmit" id="hsvReset">Reset</button>
        </div>
    </div>

    <!-- Main Container -->
    <main class="main-container">
        <!-- Image Section -->
        <section class="image-section" aria-label="Image editing area">
            <!-- Image Viewing Module -->
            <div class="imageViewingModule" role="img" aria-label="Image canvas">
                <div class="loading-overlay" id="loadingOverlay" aria-hidden="true">
                    <div class="loading-spinner" aria-label="Loading"></div>
                </div>
                <div id="imageCanvasDiv">
                    <canvas id="imageCanvas" aria-label="Image being edited"></canvas>
                </div>
            </div>

            <!-- Context Modules - Image Info -->
            <section class="context-section" id="contextSection" aria-label="Image information">
                <div class="contextModules">
                    <!-- Original Image Data Module -->
                    <div class="imageDataModule">
                        <div class="imageDataModuleSection">
                            <p>Original Image Data</p>
                        </div>
                        <div class="imageDataModuleSection">
                            <p class="sectionLabel" id="titleName">Name:</p>
                            <p class="sectionValue" id="imageName" tabindex="0">-</p>
                        </div>
                        <div class="imageDataModuleSection">
                            <p class="sectionLabel" id="titleDimensions">Dimensions:</p>
                            <p class="sectionValue" id="imageDimensions" tabindex="0">-</p>
                        </div>
                        <div class="imageDataModuleSection">
                            <p class="sectionLabel" id="titleExtension">Extension:</p>
                            <p class="sectionValue" id="imageExtension" tabindex="0">-</p>
                        </div>
                    </div>

                    <!-- Modified Image Data Module -->
                    <div class="imageDataModule">
                        <div class="imageDataModuleSection">
                            <p>Current Image Data</p>
                        </div>
                        <div class="imageDataModuleSection">
                            <p class="sectionLabel" id="titleNameModified">Name:</p>
                            <p class="sectionValue" id="imageNameModified" tabindex="0">-</p>
                        </div>
                        <div class="imageDataModuleSection">
                            <p class="sectionLabel" id="titleDimensionsModified">Dimensions:</p>
                            <p class="sectionValue" id="imageDimensionsModified" tabindex="0">-</p>
                        </div>
                        <div class="imageDataModuleSection">
                            <p class="sectionLabel" id="titleExtensionModified">Extension:</p>
                            <p class="sectionValue" id="imageExtensionModified" tabindex="0">-</p>
                        </div>
                    </div>
                </div>
            </section>
        </section>

        <!-- Layers Section -->
        <aside class="layers-section" id="layersSection" aria-label="Layers panel">
            <div class="layers-header">
                <h3>Layers</h3>
                <button class="layers-close-btn" id="layersCloseBtn" aria-label="Close layers panel">×</button>
            </div>
            
            <div id="currentLayerSelector" aria-label="Layer properties">
                <!-- Layer properties populated dynamically -->
            </div>
            
            <div id="layersSelector" aria-label="Layers list">
                <ul id="layersList" role="list">
                    <!-- Layers added here dynamically -->
                </ul>
            </div>
            
            <div id="layersControls">
                <button id="addLayer" aria-label="Add new layer">➕ Add Layer</button>
                <button id="deleteLayer" aria-label="Delete selected layer">🗑️ Delete</button>
            </div>
        </aside>
    </main>
    
    <!-- Floating Action Buttons (Mobile) -->
    <div class="fab-container">
        <!-- Quick Actions Menu -->
        <div class="quick-actions" id="quickActions">
            <div class="quick-action" id="quickOpen">
                <span class="icon">📁</span>
                <span class="label">Open</span>
            </div>
            <div class="quick-action" id="quickExportFab">
                <span class="icon">💾</span>
                <span class="label">Export</span>
            </div>
            <div class="quick-action" id="quickLayers">
                <span class="icon">📋</span>
                <span class="label">Layers</span>
            </div>
            <div class="quick-action" id="quickInfo">
                <span class="icon">ℹ️</span>
                <span class="label">Info</span>
            </div>
        </div>
        
        <!-- Secondary FABs -->
        <button class="fab secondary" id="layersFab" aria-label="Toggle layers panel">📋</button>
        <button class="fab secondary" id="infoFab" aria-label="Toggle image info">ℹ️</button>
        
        <!-- Main FAB -->
        <button class="fab" id="mainFab" aria-label="Quick actions menu">⚡</button>
    </div>
</body>
</html>